<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="CoffeeShopApplication.CheckoutPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
        xmlns:local="clr-namespace:CoffeeShopApplication.Controls"
    Shell.TabBarIsVisible="False"
    BackgroundColor="White">

    <Shell.TitleView>
        <Label Text="Your Order:"
               FontAttributes="Bold"
               FontSize="18"
               TextColor="Black"/>
    </Shell.TitleView>

    <VerticalStackLayout Padding="20" Spacing="20">

        <!-- Заголовок -->
        <!-- Список товаров -->
        <CollectionView x:Name="CartItemsCollectionView"
                        ItemsSource="{Binding CartItems}"
                        SelectionMode="None">
            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border BackgroundColor="White"
                           Padding="10"
                           Margin="0,5"
                                                           StrokeShape="RoundRectangle 10"
StrokeThickness="1">
                        <Grid ColumnDefinitions="Auto,*,Auto" RowDefinitions="Auto,Auto" Padding="5">
                            <Image Source="{Binding Image}"
                                   WidthRequest="60"
                                   HeightRequest="60"
                                   Aspect="AspectFit"
                                   Grid.RowSpan="2"/>

                            <Label Grid.Column="1"
                                   Text="{Binding Name}"
                                   FontAttributes="Bold"
                                   FontSize="16"
                                   TextColor="Black"/>

                            <HorizontalStackLayout Grid.Row="1" Grid.Column="1" Spacing="10">
                                <Label Text="{Binding Price, StringFormat='{0} AMD'}"
                                       VerticalOptions="Center"
                                       FontSize="14"
                                       TextColor="Black"/>
                                <Label Text="×"
                                       FontSize="14"
                                       VerticalOptions="Center"/>
                                <Label Text="{Binding Quantity}"
                                       VerticalOptions="Center"
                                       FontSize="14"/>
                            </HorizontalStackLayout>

                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <!-- Адрес -->
        <HorizontalStackLayout Spacing="5">
            <Image Source="location_icon.png" WidthRequest="20" HeightRequest="20"/>
            <Label Text="Մարյան 1Ի" FontAttributes="Bold" FontSize="14" TextColor="Black"/>
        </HorizontalStackLayout>

        <!-- Payment method -->
        <VerticalStackLayout Spacing="5">

            <Label Text="Payment method:"
                   FontAttributes="Bold"
                   FontSize="18"
                   TextColor="Black"/>

            <Border BackgroundColor="White"  Padding="10"
                                                                              StrokeShape="RoundRectangle 10"
StrokeThickness="1">
                <Grid ColumnDefinitions="*,Auto" VerticalOptions="Center">
                    <HorizontalStackLayout Spacing="10" VerticalOptions="Center">
                        <Image Source="{Binding SelectedPaymentMethod.Icon}" WidthRequest="24" HeightRequest="24"/>
                        <Label Text="{Binding SelectedPaymentMethod.Name}" FontSize="14" TextColor="Black"/>
                    </HorizontalStackLayout>
                    <ImageButton Grid.Column="1"
                                 Source="{Binding ExpandIcon}"
                                 BackgroundColor="Transparent"
                                 HeightRequest="24"
                                 WidthRequest="24"
                                 Clicked="OnExpandPaymentMethodsClicked"/>
                </Grid>
            </Border>

            <!-- Список всех способов оплаты -->
            <CollectionView x:Name="PaymentMethodsCollectionView"
                            IsVisible="{Binding IsPaymentMethodsExpanded}"
                            ItemsSource="{Binding PaymentMethods}"
                            SelectionMode="Single"
                            SelectionChanged="OnPaymentMethodSelected">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border BackgroundColor="White"
                               Padding="10"
                               Margin="0,5"
                                                           StrokeShape="RoundRectangle 10"
StrokeThickness="1">
                            <HorizontalStackLayout Spacing="10">
                                <Image Source="{Binding Icon}" WidthRequest="24" HeightRequest="24"/>
                                <Label Text="{Binding Name}" FontSize="14" TextColor="Black"/>
                            </HorizontalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>

        </VerticalStackLayout>

        <!-- Кнопка Checkout -->
        <Button Text="Create Order"
                Clicked="OnCreateOrderClicked"
                HeightRequest="50"
                CornerRadius="25"
                FontAttributes="Bold"
                TextColor="White">
            <Button.Background>
                <LinearGradientBrush StartPoint="0,0" EndPoint="1,0">
                    <GradientStop Color="#CB8A58" Offset="0.0" />
                    <GradientStop Color="#562B1A" Offset="1.0" />
                </LinearGradientBrush>
            </Button.Background>
        </Button>

        <!-- Total -->
        <Label x:Name="TotalLabel"
               Text="Total: 0 AMD"
               FontAttributes="Bold"
               FontSize="18"
               TextColor="Black"
               HorizontalOptions="Center"
               Margin="0,10"/>

        <!-- Навбар -->
        <!--<local:BottomNavBar/>-->

    </VerticalStackLayout>

</ContentPage>
